<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de SQL Completo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #f9f9f9;
      color: #333;
    }

    textarea, pre, select {
      width: 100%;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
      margin-top: 10px;
      box-sizing: border-box;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    textarea {
      height: 160px;
    }

    pre {
      background-color: #fff;
      height: 400px;
      overflow: auto;
      white-space: pre-wrap;
    }

    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 10px;
    }

    .generate { background-color: #28a745; color: white; }
    .copy { background-color: #007bff; color: white; }
    .clear { background-color: #dc3545; color: white; }

    label {
      font-weight: bold;
      display: block;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>Generador Completo de SQL para ADDRESS_ID</h2>

  <label for="warehouse">Selecciona el WAREHOUSE_ID:</label>
  <select id="warehouse">
    <option value="MXNL01" selected>MXNL01</option>
    <option value="MXGT01">MXGT01</option>
    <option value="MXJC01">MXJC01</option>
    <option value="MXYU01">MXYU01</option>
    <option value="MXCD05">MXCD05</option>
  </select>

  <label for="input">Ingresa los ADDRESS_ID (uno por l√≠nea):</label>
  <textarea id="input" placeholder="Ej: RK-0-113-114"></textarea>

  <div>
    <button class="generate" onclick="generateSQL()">Generar SQL</button>
    <button class="copy" onclick="copySQL()">Copiar SQL</button>
    <button class="clear" onclick="clearAll()">Limpiar</button>
  </div>

  <h3>Resultado SQL:</h3>
  <pre id="output"></pre>

  <script>
    function generateSQL() {
      const input = document.getElementById('input').value;
      const warehouse = document.getElementById('warehouse').value;
      const lines = input.split(/\r?\n/).map(line => line.trim()).filter(line => line !== '');

      if (lines.length === 0) {
        alert('Por favor ingresa al menos un ADDRESS_ID');
        return;
      }

      const addressConditions = lines.map(id => `A.ADDRESS_ID LIKE "${id}%"`).join('\n    OR ');

      const sql = `SELECT 
  A.INVENTORY_ID,
  A.ADDRESS_ID,
  A.FBM_QUANTITY,
  B.Thumbnail AS Foto,
  B.ITEM_TITLE AS Title,
  B.INSURANCE_COST AS Valor_de_seguro,
  A.FBM_CREATED_DATE AS FBM_LAST_UPDATED,
  '${warehouse}' AS CAD,
  COALESCE(C.FBM_IDENTIFIERS_EAN, C.FBM_IDENTIFIERS_GTIN, C.FBM_IDENTIFIERS_VALUE) AS Codigo_EAN
FROM 
  \`meli-bi-data.WHOWNER.BT_FBM_STOCK_3_ADDRESS\` A
LEFT JOIN 
  \`meli-bi-data.TMP.INVENTORY_ITEMS_MLM\` B
  ON A.INVENTORY_ID = B.INVENTORY_ID
LEFT JOIN
  \`meli-bi-data.WHOWNER.LK_FBM_STOCK_INVENTORIES\` C
  ON A.INVENTORY_ID = C.INVENTORY_ID
WHERE 
  A.WAREHOUSE_ID = "${warehouse}"
  AND (
    ${addressConditions}
  )
ORDER BY 
  A.FBM_CREATED_DATE DESC;`;

      document.getElementById('output').textContent = sql;
    }

    function copySQL() {
      const output = document.getElementById('output');
      if (!output.textContent.trim()) {
        alert('No hay SQL para copiar');
        return;
      }

      navigator.clipboard.writeText(output.textContent)
        .then(() => alert('SQL copiado al portapapeles'))
        .catch(err => alert('Error al copiar: ' + err));
    }

    function clearAll() {
      document.getElementById('input').value = '';
      document.getElementById('output').textContent = '';
      document.getElementById('warehouse').value = 'MXNL01';
    }
  </script>
</body>
</html>
